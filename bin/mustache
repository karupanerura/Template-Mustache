#!/usr/bin/env perl
# Original: https://github.com/defunkt/mustache/blob/master/bin/mustache

use strict;
use warnings;
use autodie;

use Template::Mustache;
use YAML::Syck;

my $doc = join('', <>);
if($doc =~ /^(\s*---(.+)---\s*)/isg) {
    my $yml = $2;
    $doc =~ s/$1//g; # remove YAML data block
    $yml =~ s/^\s+|\s+$//g; # trim whitespace
    $yml = Load($yml);
    print Template::Mustache->render($doc, $yml);
}
else {
    print Template::Mustache->render($doc);
}
